# PARALLEL OK 2 #
# NB_PAS_DT_MAX 3000 #
dimension 2
Pb_multiphase pb
Domaine dom

# BEGIN MESH #
Mailler dom
        {
        Pave carre
                {
                Origine 0. 0. 
                Nombre_de_Noeuds 11 101
                Longueurs  1.0 7.5 
                }
                {
                Bord gauche    X = 0.     0. <= Y <= 7.5    
                Bord droite    X = 1.0    0. <= Y <= 7.5
                Bord bas       Y = 0.     0. <= X <= 1.0
                Bord haut      Y = 7.5    0. <= X <= 1.0     
                }
        }
# END MESH #

# BEGIN PARTITION
Decouper dom
{
    partitionneur metis { nb_parts 2 }
    nb_parts_tot 2
    Larg_joint 2
    Nom_Zones dom
}
Fin
END PARTITION #

# BEGIN SCATTER
Scatter dom.Zones dom
END SCATTER #

PolyMAC_P0 dis Option_PolyMAC {  }

Schema_euler_implicite sch
Read sch
{
         # Initial time [s] #
        tinit 0.0
	nb_pas_dt_max 3000
          # Min time step #
        dt_min 1.e-9
          # Max time step #
        dt_max 1.e-2  # dt_min=dt_max so dt imposed #
          # stop at 1 iteration #

         # dt_start dt_fixe 1.e-4 #

        # CLF #
        facsec 1
        facsec_max 10

        # Output criteria #
          # .out files printing period #
        dt_impr 5.e-5 # Note: small value to print at each time step #
          # .sauv files printing period #
        dt_sauv 100
        periode_sauvegarde_securite_en_heures 23

        # Stop if one of the following criteria is checked: #
          # End time [s] #
        tmax 2.0
          # Max number of time steps #
          # Convergence threshold (see .dt_ev file) #
        seuil_statio 1.e-4

    solveur ice
    {
        criteres_convergence { alpha 1e-3 pression 1e-2 temperature 1e-2 vitesse 1e-2 }
        solveur petsc cli { }
        seuil_convergence_implicite 1e30
    }
}



Associate  pb dom
Associate  pb sch
Discretize pb dis

Read pb
{
	Milieu_composite
	{
		gaz_eau StiffenedGas { gamma 1.4 pinf 0.0 cv 717.1  mu 1e-6 }
		liquide_eau  StiffenedGas { gamma 2.8 pinf 8.5e8 cv 1462  mu 1e-3 }
	}
    correlations
    {
	diametre_bulles champ champ_fonc_xyz dom 2 0.001 0.
        frottement_interfacial bulles_constant { coeff_derive .1 }
    }

    QDM_Multiphase
    {
        evanescence { homogene { alpha_res 1e-4  alpha_res_min 1e-5 } } 
        solveur_pression petsc cli_quiet { -pc_type hypre -pc_hypre_type boomeramg }
        convection { amont }
        diffusion  { negligeable }
        initial_conditions
        {
            vitesse  Champ_Fonc_xyz dom 4 0 0 0 0
            pression Champ_Fonc_xyz dom 1  1e5
        }
        sources
        {
            frottement_interfacial { } ,
            source_qdm champ_fonc_xyz dom 4  0 0 -10 -10
        }
        boundary_conditions
        {
	    droite symetrie
            gauche symetrie 
            haut frontiere_ouverte_pression_imposee champ_front_uniforme 1 1.e5
            bas paroi_fixe
            # gauche symetrie #
 	    # droite symetrie #
	    # haut paroi_fixe #
	    # bas paroi_fixe #
        }
    }
    Masse_Multiphase
    {
        initial_conditions { alpha Champ_Fonc_xyz dom 2  0.5 0.5 }
        convection { amont }
        boundary_conditions {
	    droite symetrie
            gauche symetrie
            haut frontiere_ouverte a_ext Champ_Front_Uniforme 2 1 0 
            bas paroi
		# gauche symetrie #
 	   	# droite symetrie #
		# haut symetrie #
		# bas symetrie #  }
    }
    Energie_Multiphase
    {
        diffusion { negligeable }
        convection { amont }
        initial_conditions { temperature Champ_Fonc_xyz dom 2 50.0 50.0 }
        boundary_conditions {
            droite symetrie
            gauche symetrie
            haut frontiere_ouverte_temperature_imposee Champ_Front_uniforme 2 50.0 50.0
            bas paroi_temperature_imposee Champ_Front_uniforme 2 50.0 50.0
		# gauche symetrie #
 	   	# droite symetrie #
		# haut paroi_temperature_imposee Champ_Front_uniforme 2 0 0 #
		# bas paroi_temperature_imposee Champ_Front_uniforme 2 0 0 #  }
    }
    Post_processing
    {
        probes
        {
	    profil_vg vitesse_gaz_eau periode 1e-2 segment 100 0.5 0 0.5 7.5
            profil_vl vitesse_liquide_eau periode 1e-2 segment 100 0.5 0 0.5 7.5
	    profil_vl_deb vitesse_debitante_liquide_eau periode 1e-2 segment 100 0.5 0 0.5 7.5
	    profil_vg_deb vitesse_debitante_gaz_eau periode 1e-2 segment 100 0.5 0 0.5 7.5
            profil_alpha_l alpha_liquide_eau periode 1e-2 segment 100 0.5 0 0.5 7.5
        }
        Format lml
        fields dt_post 1e2
        {
            vitesse_liquide_eau elem
        }
    }
}
Solve pb
End
